@page "/counter"
@rendermode InteractiveServer
@inject IJSRuntime JSRuntime

<PageTitle>Counter</PageTitle>

<h1>Counter (with JS Interop)</h1>

<p role="status">Current count: <strong id="counter-value">@currentCount</strong></p>

<button class="btn btn-primary" @onclick="IncrementCount">
    Click me (C# only)
</button>

<button class="btn btn-outline-primary ms-2" @onclick="IncrementViaJs">
    Click me (via JS Interop)
</button>

<p class="mt-3 text-muted">
    The "C# only" button uses pure Blazor server-side logic.<br />
    The "JS Interop" button calls <code>incrementCounterJs()</code> from
    <code>js/csp-test.js</code>, demonstrating that external JS interop
    works under both CSP modes.
</p>

@if (!string.IsNullOrEmpty(_jsMessage))
{
    <div class="alert @(_jsSuccess ? "alert-success" : "alert-danger") mt-3">
        @_jsMessage
    </div>
}

@code {
    private int currentCount = 0;
    private string _jsMessage = "";
    private bool _jsSuccess;

    private void IncrementCount()
    {
        currentCount++;
    }

    private async Task IncrementViaJs()
    {
        try
        {
            currentCount = await JSRuntime.InvokeAsync<int>(
                "incrementCounterJs", currentCount);
            _jsSuccess = true;
            _jsMessage = $"JS Interop succeeded. Count is now {currentCount}.";
        }
        catch (Exception ex)
        {
            _jsSuccess = false;
            _jsMessage = $"JS Interop failed: {ex.Message}";
        }
    }
}
